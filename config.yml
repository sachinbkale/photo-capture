version: '2.0'
jobs:
  build:
     working_directory: ~/photo-capture
    
    docker:
      - image: circleci/openjdk:8-jdk-browsers   
      
    environment:
      # Customize the JVM maximum heap limit
      JVM_OPTS: -Xmx3200m
      TERM: dumb
      steps:
        - checkout
        
        - run: mvn dependency:go-offline
        - restore_cache:
          key: photo-capture-{{ checksum "pom.xml" }}
        - save_cache:
            paths:
              - ~/.m2
          key: photo-capture-{{ checksum "pom.xml" }}

        - run:
            docker login -e $DOCKER_HUB_EMAIL -u $DOCKER_HUB_USER_ID -p $DOCKER_HUB_PWD
            docker run -d --name $DOCKER_HUB_USER_ID/photo_capture $DOCKER_HUB_USER_ID/photo_capture
            docker push $DOCKER_HUB_USER_ID/photo_capture:latest
        
        - store_test_results:
            path: target/surefire-reports
        
        - store_artifacts:
            path: target/photo-capture-1.0-jar-with-dependencies.jar
